generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum TaskStatus {
  active
  boxed
  completed
  canceled
}

enum TaskCategory {
  none
  work
  personal
}

model Task {
  id                 String     @id @default(uuid())
  chatId             String
  text               String
  important          Boolean    @default(false)
  category           TaskCategory @default(none)
  emoji              String     @default("üìù")
  status             TaskStatus @default(active)
  dueAt              DateTime?
  remindEveryMinutes Int?
  nextReminderAt     DateTime?
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @updatedAt
  completedAt        DateTime?
  canceledAt         DateTime?

  reminders SentReminder[]

  @@index([chatId, status])
  @@index([chatId, dueAt])
  @@index([chatId, nextReminderAt])
}

model ProcessedUpdate {
  id        String   @id @default(uuid())
  chatId    String
  updateId  Int
  createdAt DateTime @default(now())

  @@unique([chatId, updateId])
  @@index([createdAt])
}

model SentReminder {
  id          String   @id @default(uuid())
  taskId       String
  task         Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)
  scheduledAt  DateTime
  telegramMessageId String?
  createdAt    DateTime @default(now())

  @@unique([taskId, scheduledAt])
  @@index([scheduledAt])
}
